define(["can/util/library","can/view/callbacks","can/control","can/observe","can/view/mustache","can/view/bindings"],function(t,e){var n=/^(dataViewId|class|id)$/i,o=/\{([^\}]+)\}/g,s=t.Component=t.Construct.extend({setup:function(){if(t.Construct.setup.apply(this,arguments),t.Component){var e=this,n=this.prototype.scope;if(this.Control=i.extend(this.prototype.events),n&&("object"!=typeof n||n instanceof t.Map)?n.prototype instanceof t.Map&&(this.Map=n):this.Map=t.Map.extend(n||{}),this.attributeScopeMappings={},t.each(this.Map?this.Map.defaults:{},function(t,n){"@"===t&&(e.attributeScopeMappings[n]=n)}),this.prototype.template)if("function"==typeof this.prototype.template){var o=this.prototype.template;this.renderer=function(){return t.view.frag(o.apply(null,arguments))}}else this.renderer=t.view.mustache(this.prototype.template);t.view.tag(this.prototype.tag,function(t,n){new e(t,n)})}}},{setup:function(o,s){var i,a,r,p={},c=this,u={};if(t.each(this.constructor.attributeScopeMappings,function(e,n){p[n]=o.getAttribute(t.hyphenate(e))}),t.each(t.makeArray(o.attributes),function(r){var l=t.camelize(r.nodeName.toLowerCase()),h=r.value;if(n.test(l)&&"{"===h[0]&&"}"===h[h.length-1]&&t.dev.warn("can/component: looks like you're trying to pass "+l+" as an attribute into a component, but it is not a supported attribute"),!(c.constructor.attributeScopeMappings[l]||n.test(l)||e.attr(r.nodeName))){if("{"===h[0]&&"}"===h[h.length-1])h=h.substr(1,h.length-2);else if("legacy"!==s.templateType)return void(p[l]=h);var d=s.scope.computeData(h,{args:[]}),f=d.compute,m=function(t,e){i=l,a.attr(l,e),i=null};f.bind("change",m),p[l]=f(),f.hasDependencies?(t.bind.call(o,"removed",function(){f.unbind("change",m)}),u[l]=d):f.unbind("change",m)}}),this.constructor.Map)a=new this.constructor.Map(p);else if(this.scope instanceof t.Map)a=this.scope;else if(t.isFunction(this.scope)){var l=this.scope(p,s.scope,o);a=l instanceof t.Map?l:l.prototype instanceof t.Map?new l(p):new(t.Map.extend(l))(p)}var h={};t.each(u,function(t,e){h[e]=function(n,o){i!==e&&t.compute(o)},a.bind(e,h[e])}),t.bind.call(o,"removed",function(){t.each(h,function(t,e){a.unbind(e,h[e])})}),t.isEmptyObject(this.constructor.attributeScopeMappings)&&"legacy"===s.templateType||t.bind.call(o,"attributes",function(e){var s=t.camelize(e.attributeName);u[s]||n.test(s)||a.attr(s,o.getAttribute(e.attributeName))}),this.scope=a,t.data(t.$(o),"scope",this.scope);var d=s.scope.add(this.scope),f={helpers:{}};t.each(this.helpers||{},function(e,n){t.isFunction(e)&&(f.helpers[n]=function(){return e.apply(a,arguments)})}),this._control=new this.constructor.Control(o,{scope:this.scope}),this.constructor.renderer?(f.tags||(f.tags={}),f.tags.content=function m(e,n){var o=s.subtemplate||n.subtemplate;o&&(delete f.tags.content,t.view.live.replace([e],o(n.scope,n.options)),f.tags.content=m)},r=this.constructor.renderer(d,s.options.add(f))):r="legacy"===s.templateType?t.view.frag(s.subtemplate?s.subtemplate(d,s.options.add(f)):""):s.subtemplate?s.subtemplate(d,s.options.add(f)):document.createDocumentFragment(),t.appendChild(o,r)}}),i=t.Control.extend({_lookup:function(t){return[t.scope,t,window]},_action:function(e,n,s){var i,a;if(o.lastIndex=0,i=o.test(e),s||!i){if(i){a=t.compute(function(){var s,i=e.replace(o,function(e,o){var i;return"scope"===o?(s=n.scope,""):(o=o.replace(/^scope\./,""),i=t.compute.read(n.scope,o.split("."),{isArgument:!0}).value,void 0===i&&(i=t.getObject(o)),"string"==typeof i?i:(s=i,""))}),a=i.split(/\s+/g),r=a.pop();return{processor:this.processors[r]||this.processors.click,parts:[i,a.join(" "),r],delegate:s||void 0}},this);var r=function(t,n){s._bindings.control[e](s.element),s._bindings.control[e]=n.processor(n.delegate||s.element,n.parts[2],n.parts[1],e,s)};return a.bind("change",r),s._bindings.readyComputes[e]={compute:a,handler:r},a()}return t.Control._action.apply(this,arguments)}}},{setup:function(e,n){return this.scope=n.scope,t.Control.prototype.setup.call(this,e,n)},off:function(){this._bindings&&t.each(this._bindings.readyComputes||{},function(t){t.compute.unbind("change",t.handler)}),t.Control.prototype.off.apply(this,arguments),this._bindings.readyComputes={}}});return window.jQuery&&jQuery.fn&&(jQuery.fn.scope=function(t){return t?this.data("scope").attr(t):this.data("scope")}),t.scope=function(e,n){return e=t.$(e),n?t.data(e,"scope").attr(n):t.data(e,"scope")},s});
//# sourceMappingURL=component.js.map