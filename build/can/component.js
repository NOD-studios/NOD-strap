define(["can/util/library","can/view/callbacks","can/control","can/observe","can/view/mustache","can/view/bindings"],function(t,e){var n=/^(dataViewId|class|id)$/i,o=/\{([^\}]+)\}/g,s=t.Component=t.Construct.extend({setup:function(){if(t.Construct.setup.apply(this,arguments),t.Component){var e=this,n=this.prototype.scope||this.prototype.viewModel;if(this.Control=i.extend(this.prototype.events),n&&("object"!=typeof n||n instanceof t.Map)?n.prototype instanceof t.Map&&(this.Map=n):this.Map=t.Map.extend(n||{}),this.attributeScopeMappings={},t.each(this.Map?this.Map.defaults:{},function(t,n){"@"===t&&(e.attributeScopeMappings[n]=n)}),this.prototype.template)if("function"==typeof this.prototype.template){var o=this.prototype.template;this.renderer=function(){return t.view.frag(o.apply(null,arguments))}}else this.renderer=t.view.mustache(this.prototype.template);t.view.tag(this.prototype.tag,function(t,n){new e(t,n)})}}},{setup:function(o,s){var i,a,r,c={},p=this,u=("undefined"==typeof this.leakScope?!1:!this.leakScope)&&this.template,l={},h=this.scope||this.viewModel;if(t.each(this.constructor.attributeScopeMappings,function(e,n){c[n]=o.getAttribute(t.hyphenate(e))}),t.each(t.makeArray(o.attributes),function(r){var u=t.camelize(r.nodeName.toLowerCase()),h=r.value;if(n.test(u)&&"{"===h[0]&&"}"===h[h.length-1]&&t.dev.warn("can/component: looks like you're trying to pass "+u+" as an attribute into a component, but it is not a supported attribute"),!(p.constructor.attributeScopeMappings[u]||n.test(u)||e.attr(r.nodeName))){if("{"===h[0]&&"}"===h[h.length-1])h=h.substr(1,h.length-2);else if("legacy"!==s.templateType)return void(c[u]=h);var d=s.scope.computeData(h,{args:[]}),f=d.compute,m=function(t,e){i=u,a.attr(u,e),i=null};f.bind("change",m),c[u]=f(),f.computeInstance.hasDependencies?(t.bind.call(o,"removed",function(){f.unbind("change",m)}),l[u]=d):f.unbind("change",m)}}),this.constructor.Map)a=new this.constructor.Map(c);else if(h instanceof t.Map)a=h;else if(t.isFunction(h)){var d=h.call(this,c,s.scope,o);a=d instanceof t.Map?d:d.prototype instanceof t.Map?new d(c):new(t.Map.extend(d))(c)}var f={};t.each(l,function(t,e){f[e]=function(n,o){i!==e&&t.compute(o)},a.bind(e,f[e])}),t.isEmptyObject(this.constructor.attributeScopeMappings)&&"legacy"===s.templateType||t.bind.call(o,"attributes",function(e){var s=t.camelize(e.attributeName);l[s]||n.test(s)||a.attr(s,o.getAttribute(e.attributeName))}),this.scope=this.viewModel=a,t.data(t.$(o),"scope",this.scope);var m=u?this.scope:s.scope.add(this.scope),g={helpers:{}};t.each(this.helpers||{},function(e,n){t.isFunction(e)&&(g.helpers[n]=function(){return e.apply(a,arguments)})});var v=function(){t.each(f,function(t,e){a.unbind(e,f[e])})};if(this._control=new this.constructor.Control(o,{scope:this.scope,viewModel:this.scope}),this._control&&this._control.destroy){var b=this._control.destroy;this._control.destroy=function(){b.apply(this,arguments),v()},this._control.on()}else t.bind.call(o,"removed",function(){v()});this.constructor.renderer?(g.tags||(g.tags={}),g.tags.content=function y(e,n){var o=s.subtemplate||n.subtemplate;if(o){delete g.tags.content;var i=u&&o===s.subtemplate?s:n;t.view.live.replace([e],o(i.scope,i.options)),g.tags.content=y}},r=this.constructor.renderer(m,s.options.add(g))):r="legacy"===s.templateType?t.view.frag(s.subtemplate?s.subtemplate(m,s.options.add(g)):""):s.subtemplate?s.subtemplate(m,s.options.add(g)):document.createDocumentFragment(),t.appendChild(o,r)}}),i=t.Control.extend({_lookup:function(t){return[t.scope,t,window]},_action:function(e,n,s){var i,a;if(o.lastIndex=0,i=o.test(e),s||!i){if(i){a=t.compute(function(){var s,i=e.replace(o,function(e,o){var i;return"scope"===o||"viewModel"===o?(s=n.scope,""):(o=o.replace(/^scope|^viewModel\./,""),i=t.compute.read(n.scope,o.split("."),{isArgument:!0}).value,void 0===i&&(i=t.getObject(o)),"string"==typeof i?i:(s=i,""))}),a=i.split(/\s+/g),r=a.pop();return{processor:this.processors[r]||this.processors.click,parts:[i,a.join(" "),r],delegate:s||void 0}},this);var r=function(t,n){s._bindings.control[e](s.element),s._bindings.control[e]=n.processor(n.delegate||s.element,n.parts[2],n.parts[1],e,s)};return a.bind("change",r),s._bindings.readyComputes[e]={compute:a,handler:r},a()}return t.Control._action.apply(this,arguments)}}},{setup:function(e,n){return this.scope=n.scope,t.Control.prototype.setup.call(this,e,n)},off:function(){this._bindings&&t.each(this._bindings.readyComputes||{},function(t){t.compute.unbind("change",t.handler)}),t.Control.prototype.off.apply(this,arguments),this._bindings.readyComputes={}}});t.scope=t.viewModel=function(e,n,o){e=t.$(e);var s=t.data(e,"scope");switch(s||(s=new t.Map,t.data(e,"scope",s)),arguments.length){case 0:case 1:return s;case 2:return s.attr(n);default:return s.attr(n,o),e}};var a=t.$;return a.fn&&(a.fn.scope=a.fn.viewModel=function(){return t.viewModel.apply(t,[this].concat(t.makeArray(arguments)))}),s});
//# sourceMappingURL=component.js
//# sourceMappingURL=component.js.map