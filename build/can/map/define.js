define(["can/util/library","can/observe"],function(e){e.Map.helpers.define=function(t){var n=t.prototype.define;t.define&&e.dev.warn("The define property should be on the map's prototype properties, not the static properies."),t.defaultGenerators={};for(var i in n)"value"in n[i]&&("function"==typeof n[i].value?t.defaultGenerators[i]=n[i].value:t.defaults[i]=n[i].value),"function"==typeof n[i].Value&&!function(e){t.defaultGenerators[i]=function(){return new e}}(n[i].Value)};var t=e.Map.prototype._setupDefaults;e.Map.prototype._setupDefaults=function(e){var n=t.call(this),i={},r=this.constructor,a=this._get;this._get=function(e){return s=-1!==e.indexOf(".")?e.substr(0,e.indexOf(".")):s,s in n&&!(s in i)&&(this.attr(s,n[s]),i[s]=!0),a.apply(this,arguments)};for(var s in r.defaultGenerators)e&&s in e||(n[s]=r.defaultGenerators[s].call(this));return this._get=a,n};var n=e.Map.prototype,i=n.__set;n.__set=function(t,n,r,a,s){var o,u=function(n){clearTimeout(o);var i=s&&s.call(l,n);return i!==!1&&e.trigger(l,"error",[t,n],!0),!1},l=this,f=this.define&&this.define[t],p=f&&f.set,c=f&&f.get;if(p){e.batch.start();var h=!1,d=p.call(this,n,function(e){i.call(l,t,e,r,a,u),h=!0,clearTimeout(o)},u);return c?void e.batch.stop():void 0===d&&!h&&p.length>=2?(o=setTimeout(function(){e.dev.warn('can/map/setter.js: Setter "'+t+'" did not return a value or call the setter callback.')},e.dev.warnTimeout),void e.batch.stop()):(h||i.call(l,t,0===p.length&&void 0===d?n:d,r,a,u),e.batch.stop(),this)}return i.call(l,t,n,r,a,u),this};var r={date:function(e){var t=typeof e;return"string"===t?(e=Date.parse(e),isNaN(e)?null:new Date(e)):"number"===t?new Date(e):e},number:function(e){return+e},"boolean":function(e){return"false"!==e&&"0"!==e&&e?!0:!1},"*":function(e){return e},string:function(e){return""+e}},a=n.__type;n.__type=function(e,t){var n=this.define&&this.define[t],i=n&&n.type,s=n&&n.Type,o=e;return"string"==typeof i&&(i=r[i]),i||s?(i&&(o=i.call(this,o,t)),!s||o instanceof s||(o=new s(o)),o):a.call(this,o,t)};var s=n._remove;n._remove=function(t,n){var i,r=this.define&&this.define[t]&&this.define[t].remove;return r?(e.batch.start(),i=r.call(this,n),i===!1?void e.batch.stop():(i=s.call(this,t,n),e.batch.stop(),i)):s.call(this,t,n)};var o=n._setupComputes;n._setupComputes=function(t){o.apply(this,arguments);for(var n in this.define){var i=this.define[n],r=i.get;r&&(this[n]=e.compute.async(t[n],r,this),this._computedBindings[n]={count:0})}};var u=e.Map.helpers._serialize;e.Map.helpers._serialize=function(e,t,n){return l(e,t,n)};var l=function(e,t,n){var i=e.define&&e.define[t]&&e.define[t].serialize;return void 0===i?u.apply(this,arguments):i!==!1?"function"==typeof i?i.call(e,n,t):u.apply(this,arguments):void 0},f=n.serialize;return n.serialize=function(e){var t=f.apply(this,arguments);if(e)return t;var n,i;for(var r in this.define)r in t||(n=this.define&&this.define[r]&&this.define[r].serialize,n&&(i=l(this,r,this.attr(r)),void 0!==i&&(t[r]=i)));return t},e.Map});
//# sourceMappingURL=define.js.map