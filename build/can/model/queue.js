define(["can/util/library","can/model","can/map/backup"],function(t){var e=function(e,r){var n,s,i=t.extend(!0,{},r);if(e)for(var u=0;u<e.length;u++){for(n=i,s=e[u].split(".");s.length>1;)n=n&&n[s.shift()];n&&delete n[s.shift()]}return i},r=function(e,r,n,s){this._changedAttrs=this._changedAttrs||[];var i,u,o=new t.Deferred,a=this,h=this.serialize(),c=this._requestQueue,p=this._changedAttrs;return i=function(t,e,r,n){return function(){return t.constructor._makeRequest([t,h],e||(t.isNew()?"create":"update"),r,n,s)}}(this,n,function(){o.resolveWith(a,arguments),c.splice(0,1),c.length>0?c[0]=c[0]():p.splice(0)},function(){o.rejectWith(a,arguments),c.splice(0),p.splice(0)}),u=c.push(i)-1,1===c.length&&(c[0]=c[0]()),o.abort=function(){var t;return t=c[u].abort&&c[u].abort(),c.splice(u),0===c.length&&p.splice(0),t},o.then(e,r),o},n=t.Model.prototype._triggerChange,s=t.Model.prototype.destroy,i=t.Model.prototype.setup;return t.each(["created","updated","destroyed"],function(r){var n=t.Model.prototype[r];t.Model.prototype[r]=function(t){t&&"object"==typeof t&&(t=t.attr?t.attr():t,this._backupStore(t),t=e(this._changedAttrs||[],t)),n.call(this,t)}}),t.extend(t.Model.prototype,{setup:function(){i.apply(this,arguments),this._requestQueue=new t.List},_triggerChange:function(t){this._changedAttrs&&this._changedAttrs.push(t),n.apply(this,arguments)},hasQueuedRequests:function(){return this._requestQueue.attr("length")>1},save:function(){return r.apply(this,arguments)},destroy:function(t,e){return this.isNew()?s.call(this,t,e):r.call(this,t,e,"destroy","destroyed")}}),t});
//# sourceMappingURL=queue.js
//# sourceMappingURL=queue.js.map