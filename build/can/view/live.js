define(["can/util/library","can/elements","can/view","can/view/node_lists","can/view/parser"],function(e,t,n,r,a){t=t||e.view.elements,r=r||e.view.NodeLists,a=a||e.view.parser;var i=function(t,n,r){var a=!1,i=function(){return a||(a=!0,r(o),e.unbind.call(t,"removed",i)),!0},o={teardownCheck:function(e){return e?!1:i()}};return e.bind.call(t,"removed",i),n(o),o},o=function(e,t,n){return i(e,function(){t.bind("change",n)},function(e){t.unbind("change",n),e.nodeList&&r.unregister(e.nodeList)})},c=function(e){var t,n={};return a.parseAttrs(e,{attrStart:function(e){n[e]="",t=e},attrValue:function(e){n[t]+=e},attrEnd:function(){}}),n},u=[].splice,d=function(e){return e&&e.nodeType},s=function(e){e.childNodes.length||e.appendChild(document.createTextNode(""))},l={list:function(n,a,o,c,d,s){var p,f=s||[n],h=[],v=e.batch.batchNum,g=function(n,a,i){if(!n.batchNum||n.batchNum!==v){var d=document.createDocumentFragment(),l=[],p=[];e.each(a,function(t,n){var a=[];s&&r.register(a,null,!0);var u=e.compute(n+i),f=o.call(c,t,u,a),h="string"==typeof f,v=e.frag(f);v=h?e.view.hookup(v):v;var g=e.makeArray(v.childNodes);s?(r.update(a,g),l.push(a)):l.push(r.register(g)),d.appendChild(v),p.push(u)});var g=i+1;if(f[g]){var b=r.first(f[g]);e.insertBefore(b.parentNode,d,b)}else t.after(1===g?[w]:[r.last(f[g-1])],d);u.apply(f,[g,0].concat(l)),u.apply(h,[i,0].concat(p));for(var m=i+p.length,N=h.length;N>m;m++)h[m](m)}},b=function(t,n,a,i,o){if(i||!A.teardownCheck(w.parentNode)){0>a&&(a=h.length+a);var c=f.splice(a+1,n.length),u=[];e.each(c,function(e){var t=r.unregister(e);[].push.apply(u,t)}),h.splice(a,n.length);for(var d=a,s=h.length;s>d;d++)h[d](d);o?r.unregister(f):e.remove(e.$(u))}},m=function(e,t,n,r){n+=1,r+=1;var a=f[n][0],i=f[r][0],o=a.parentNode;n>r&&(a=a.nextSibling),o.insertBefore(i,a);var c=f[r];[].splice.apply(f,[r,1]),[].splice.apply(f,[n,0,c])},w=document.createTextNode(""),N=function(e){p&&p.unbind&&p.unbind("add",g).unbind("remove",b),b({},{length:f.length-1},0,!0,e)},k=function(e,t){N(),p=t||[],p.bind&&p.bind("add",g).bind("remove",b).bind("move",m),g({},p,0)};d=t.getParentNode(n,d);var A=i(d,function(){e.isFunction(a)&&a.bind("change",k)},function(){e.isFunction(a)&&a.unbind("change",k),N(!0)});s?(t.replace(f,w),r.update(f,[w]),s.unregistered=A.teardownCheck):l.replace(f,w,A.teardownCheck),k({},e.isFunction(a)?a():a)},html:function(n,a,i,c){var u;i=t.getParentNode(n,i),u=o(i,a,function(e,t){var n=r.first(l).parentNode;n&&p(t),u.teardownCheck(r.first(l).parentNode)});var l=c||[n],p=function(n){var a="function"==typeof n,o=d(n),c=e.frag(a?"":n),u=e.makeArray(l);s(c),o||a||(c=e.view.hookup(c,i)),u=r.update(l,c.childNodes),a&&n(c.childNodes[0]),t.replace(u,c)};u.nodeList=l,c?c.unregistered=u.teardownCheck:r.register(l,u.teardownCheck),p(a())},replace:function(n,a,i){var o=n.slice(0),c=e.frag(a);return r.register(n,i),"string"==typeof a&&(c=e.view.hookup(c,n[0].parentNode)),r.update(n,c.childNodes),t.replace(o,c),n},text:function(n,a,i,c){var u=t.getParentNode(n,i),d=o(u,a,function(t,n){"unknown"!=typeof s.nodeValue&&(s.nodeValue=e.view.toStr(n)),d.teardownCheck(s.parentNode)}),s=document.createTextNode(e.view.toStr(a()));c?(c.unregistered=d.teardownCheck,d.nodeList=c,r.update(c,[s]),t.replace([n],s)):d.nodeList=l.replace([n],s,d.teardownCheck)},setAttributes:function(t,n){var r=c(n);for(var a in r)e.attr.set(t,a,r[a])},attributes:function(n,r,a){var i={},u=function(r){var a,o=c(r);for(a in o){var u=o[a],d=i[a];u!==d&&e.attr.set(n,a,u),delete i[a]}for(a in i)t.removeAttr(n,a);i=o};o(n,r,function(e,t){u(t)}),arguments.length>=3?i=c(a):u(r())},attributePlaceholder:"__!!__",attributeReplace:/__!!__/g,attribute:function(n,r,a){o(n,a,function(){t.setAttr(n,r,u.render())});var i,c=e.$(n);i=e.data(c,"hooks"),i||e.data(c,"hooks",i={});var u,d=t.getAttr(n,r),s=d.split(l.attributePlaceholder),p=[];p.push(s.shift(),s.join(l.attributePlaceholder)),i[r]?i[r].computes.push(a):i[r]={render:function(){var e=0,n=d?d.replace(l.attributeReplace,function(){return t.contentText(u.computes[e++]())}):t.contentText(u.computes[e++]());return n},computes:[a],batchNum:void 0},u=i[r],p.splice(1,0,a()),t.setAttr(n,r,p.join(""))},specialAttribute:function(e,n,r){o(e,r,function(r,a){t.setAttr(e,n,f(a))}),t.setAttr(e,n,f(r()))},simpleAttribute:function(e,n,r){o(e,r,function(r,a){t.setAttr(e,n,a)}),t.setAttr(e,n,r())}};l.attr=l.simpleAttribute,l.attrs=l.attributes;var p=/(\r|\n)+/g,f=function(e){var n=/^["'].*["']$/;return e=e.replace(t.attrReg,"").replace(p,""),n.test(e)?e.substr(1,e.length-2):e};return e.view.live=l,l});
//# sourceMappingURL=live.js
//# sourceMappingURL=live.js.map