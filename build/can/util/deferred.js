define(["can/util/can"],function(t){var e=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},n=function(t){return this instanceof n?(this._doneFuncs=[],this._failFuncs=[],this._resultArgs=null,this._status="",void(t&&t.call(this,this))):new n};t.Deferred=n,t.when=n.when=function(){var e=t.makeArray(arguments);if(e.length<2){var r=e[0];return r&&t.isFunction(r.isResolved)&&t.isFunction(r.isRejected)?r:n().resolve(r)}var s=n(),i=0,u=[];return t.each(e,function(t,n){t.done(function(){u[n]=arguments.length<2?arguments[0]:arguments,++i===e.length&&s.resolve.apply(s,u)}).fail(function(){s.reject(1===arguments.length?arguments[0]:arguments)})}),s};var r=function(t,e){return function(n){var r=this._resultArgs=arguments.length>1?arguments[1]:[];return this.exec(n,this[t],r,e)}},s=function a(e,n){return function(){var r=this;return t.each(Array.prototype.slice.call(arguments),function(t){t&&(t.constructor===Array?a.apply(r,t):(r._status===n&&t.apply(r,r._resultArgs||[]),r[e].push(t)))}),this}},i=function(t){return t&&t.then&&t.fail&&t.done},u=function(e,n,r,s){i(n)?n.done(t.proxy(e.resolve,e)).fail(t.proxy(e.reject,e)):r.call(e,void 0!==n?n:s)};return e(n.prototype,{then:function(e,n){var r=t.Deferred(),s=r.resolve,i=r.reject;return this.done(function(t){"function"==typeof e?u(r,e.apply(this,arguments),s,t):s.apply(r,arguments)}),this.fail(function(t){"function"==typeof n?u(r,n.apply(this,arguments),i,t):i.apply(r,arguments)}),r},resolveWith:r("_doneFuncs","rs"),rejectWith:r("_failFuncs","rj"),done:s("_doneFuncs","rs"),fail:s("_failFuncs","rj"),always:function(){var e=t.makeArray(arguments);return e.length&&e[0]&&this.done(e[0]).fail(e[0]),this},state:function(){switch(this._status){case"rs":return"resolved";case"rj":return"rejected";default:return"pending"}},isResolved:function(){return"rs"===this._status},isRejected:function(){return"rj"===this._status},reject:function(){return this.rejectWith(this,arguments)},resolve:function(){return this.resolveWith(this,arguments)},exec:function(e,n,r,s){return""!==this._status?this:(this._status=s,t.each(n,function(t){"function"==typeof t.apply&&t.apply(e,r)}),this)},promise:function(){var t=this.then();return t.reject=t.resolve=void 0,t}}),n.prototype.pipe=n.prototype.then,t});
//# sourceMappingURL=deferred.js.map