define(["can/util/library","can/map","can/bubble"],function(t,e,i){var r=[].splice,h=function(){var t={0:"a",length:1};return r.call(t,0,1),!t[0]}(),n=e.extend({Map:e},{setup:function(e,i){this.length=0,t.cid(this,".map"),this._init=1,this._computedBindings={},this._setupComputes(),e=e||[];var r;t.isDeferred(e)?this.replace(e):(r=e.length&&t.Map.helpers.addToMap(e,this),this.push.apply(this,t.makeArray(e||[]))),r&&r(),this.bind("change",t.proxy(this._changes,this)),t.simpleExtend(this,i),delete this._init},_triggerChange:function(i,r,h,n){e.prototype._triggerChange.apply(this,arguments);var s=+i;~(""+i).indexOf(".")||isNaN(s)||("add"===r?(t.batch.trigger(this,r,[h,s]),t.batch.trigger(this,"length",[this.length])):"remove"===r?(t.batch.trigger(this,r,[n,s]),t.batch.trigger(this,"length",[this.length])):t.batch.trigger(this,r,[h,s]))},__get:function(e){return e?this[e]&&this[e].isComputed&&t.isFunction(this.constructor.prototype[e])?this[e]():this[e]:this},__set:function(e,i,r){if(e=isNaN(+e)||e%1?e:+e,"number"==typeof e&&e>this.length-1){var h=new Array(e+1-this.length);h[h.length-1]=i,i=h,e=this.length}return t.Map.prototype.__set.call(this,""+e,i,r)},___set:function(t,e){this[t]=e,+t>=this.length&&(this.length=+t+1)},_remove:function(t,e){isNaN(+t)?(delete this[t],this._triggerChange(t,"remove",void 0,e)):this.splice(t,1)},_each:function(t){for(var e=this.__get(),i=0;i<e.length;i++)t(e[i],i)},serialize:function(){return e.helpers.serialize(this,"serialize",[])},splice:function(e,n){var s,a,o,l=t.makeArray(arguments),g=[],c=l.length>2;for(e=e||0,s=0,a=l.length-2;a>s;s++)o=s+2,l[o]=this.__type(l[o],o),g.push(l[o]),this[s+e]!==l[o]&&(c=!1);if(c)return g;void 0===n&&(n=l[1]=this.length-e);var p=r.apply(this,l);if(!h)for(s=this.length;s<p.length+this.length;s++)delete this[s];if(t.batch.start(),n>0&&(i.removeMany(this,p),this._triggerChange(""+e,"remove",void 0,p)),l.length>2){for(s=0,a=g.length;a>s;s++)i.set(this,s,g[s]);this._triggerChange(""+e,"add",g,p)}return t.batch.stop(),p},_attrs:function(i,r){return void 0===i?e.helpers.serialize(this,"attr",[]):(i=t.makeArray(i),t.batch.start(),this._updateAttrs(i,r),void t.batch.stop())},_updateAttrs:function(t,i){for(var r=Math.min(t.length,this.length),h=0;r>h;h++){var n=this[h],s=t[h];e.helpers.isObservable(n)&&e.helpers.canMakeObserve(s)?n.attr(s,i):n!==s&&this._set(h,s)}t.length>this.length?this.push.apply(this,t.slice(this.length)):t.length<this.length&&i&&this.splice(t.length)}}),s=function(e){return e[0]&&t.isArray(e[0])?e[0]:t.makeArray(e)};return t.each({push:"length",unshift:0},function(t,e){var r=[][e];n.prototype[e]=function(){for(var e,h,n=[],s=t?this.length:0,a=arguments.length;a--;)h=arguments[a],n[a]=i.set(this,a,this.__type(h,a));return e=r.apply(this,n),(!this.comparator||n.length)&&this._triggerChange(""+s,"add",n,void 0),e}}),t.each({pop:"length",shift:0},function(t,e){n.prototype[e]=function(){if(!this.length)return void 0;var r=s(arguments),h=t&&this.length?this.length-1:0,n=[][e].apply(this,r);return this._triggerChange(""+h,"remove",void 0,[n]),n&&n.unbind&&i.remove(this,n),n}}),t.extend(n.prototype,{indexOf:function(e,i){return this.attr("length"),t.inArray(e,this,i)},join:function(){return[].join.apply(this.attr(),arguments)},reverse:function(){var e=[].reverse.call(t.makeArray(this));this.replace(e)},slice:function(){var t=Array.prototype.slice.apply(this,arguments);return new this.constructor(t)},concat:function(){var e=[];return t.each(t.makeArray(arguments),function(i,r){e[r]=i instanceof t.List?i.serialize():i}),new this.constructor(Array.prototype.concat.apply(this.serialize(),e))},forEach:function(e,i){return t.each(this,e,i||this)},replace:function(e){return t.isDeferred(e)?e.then(t.proxy(this.replace,this)):this.splice.apply(this,[0,this.length].concat(t.makeArray(e||[]))),this},filter:function(e,i){var r,h=new t.List,n=this;return this.each(function(t,s){r=e.call(i|n,t,s,n),r&&h.push(t)}),h}}),t.List=e.List=n,t.List});
//# sourceMappingURL=list.js
//# sourceMappingURL=list.js.map