define(["require","./normalize"],function(e,r){function s(e){if("undefined"!=typeof process&&process.versions&&process.versions.node&&require.nodeRequire){try{var r=require.nodeRequire("csso")}catch(s){return console.log('Compression module not installed. Use "npm install csso -g" to enable.'),e}try{var t=e.length;return e=r.justDoIt(e),console.log("Compressed CSS output to "+Math.round(e.length/t*100)+"%."),e}catch(s){return console.log("Unable to compress css.\n"+s),e}}return console.log("Compression not supported outside of nodejs environments."),e}function t(e,r){if("undefined"!=typeof process&&process.versions&&process.versions.node&&require.nodeRequire){var s=require.nodeRequire("fs");s.writeFileSync(e,r,"utf8")}else{var t=new java.lang.String(r),n=new java.io.BufferedWriter(new java.io.OutputStreamWriter(new java.io.FileOutputStream(e),"utf-8"));try{n.write(t,0,t.length()),n.flush()}finally{n.close()}}}function n(e){return e.replace(/(["'\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")}var o={},a=!!process.platform.match(/^win/),l=function(e){return a?e.replace(/\\/g,"/"):e},i=l(e.toUrl("base_url")).split("/");i[i.length-1]="";var u,c,d=i.join("/"),p=require.nodeRequire("less"),f=require.nodeRequire("path"),g=[],m={};o.normalize=function(e,r){return".less"==e.substr(e.length-5,5)&&(e=e.substr(0,e.length-5)),r(e)};var v=/^([^\:\/]+:\/)?\//;o.load=function(e,s,t,n){if(u=u||n,c||(c=f.resolve(u.dir||f.dirname(u.out),u.siteRoot||".")+"/",c=l(c)),e.match(v))return t();var o=l(s.toUrl(e+".less")),a=n.less||{};a.paths=[d],a.filename=o,a.async=!1,a.syncImport=!0;var i=new p.Parser(a);i.parse('@import (multiple) "'+f.relative(d,o)+'";',function(s,n){if(s)return console.log(s+" at "+f.relative(d,s.filename)+", line "+s.line),t.error(s);var a=n.toCSS(u.less);m[e]=r(a,o,c),t()},a)};var g=[];return o.write=function(e,r,s){r.match(v)||(g.push(m[r]),global._requirejsCssData?global._requirejsCssData.usedBy.less=!0:global._requirejsCssData={usedBy:{less:!0},css:""},s.asModule(e+"!"+r,"define(function(){})"))},o.onLayerEnd=function(e,o){var a=g.join("");if(u.separateCSS){console.log("Writing CSS! file: "+o.name+"\n");var i=u.dir?f.resolve(u.dir,u.baseUrl,o.name+".css"):u.out.replace(/(\.js)?$/,".css");i=l(i),a=r(a,c,i),process.nextTick(function(){global._requirejsCssData&&(a=global._requirejsCssData.css=a+global._requirejsCssData.css,delete global._requirejsCssData.usedBy.less,0===Object.keys(global._requirejsCssData.usedBy).length&&delete global._requirejsCssData),t(i,s(a))})}else{if(""==a)return;e("(function(c){var d=document,a='appendChild',i='styleSheet',s=d.createElement('style');s.type='text/css';d.getElementsByTagName('head')[0][a](s);s[i]?s[i].cssText=c:s[a](d.createTextNode(c));})\n('"+n(s(a))+"');\n")}g=[]},o});
//# sourceMappingURL=less-builder.js.map